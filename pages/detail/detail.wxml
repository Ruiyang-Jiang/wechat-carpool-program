<!-- é¡µé¢éª¨æ¶ï¼šç®€è¦ loading -->
<view wx:if="{{isLoading}}" class="page-loading">åŠ è½½ä¸­...</view>

<block wx:else>
  <!-- ======= è¡Œç¨‹ä¿¡æ¯å¡ ======= -->
  <view class="ride-card {{detail.isPast?'past':''}}">
    <!-- header -->
    <view class="ride-header">
      <text class="badge {{detail.type==='ride'?'badge-driver':'badge-passenger'}}">
        {{detail.type==='ride'?'æ‰¾ä¹˜å®¢':'æ‰¾å¸æœº'}}
      </text>
      <text class="ride-date {{detail.isPast?'date-past':''}}">
        {{detail.departure_date}} {{detail.departure_time||'00:00'}}
      </text>
      <text wx:if="{{detail.isPast}}" class="expired-badge">å·²è¿‡æœŸ</text>
    </view>

    <!-- body -->
    <view class="ride-body">
      <view class="row">
        <text>å‡ºå‘åœ°ï¼š</text>
        <text class="bold">{{detail.departure_place.city}}, {{detail.departure_place.state}}</text>
      </view>
      <view class="row">
        <text>ç›®çš„åœ°ï¼š</text>
        <text class="bold">{{detail.arrival_place.city}}, {{detail.arrival_place.state}}</text>
      </view>

      <!-- é€”ç»ç‚¹æ˜¾ç¤º -->
      <view wx:if="{{detail.stopovers && detail.stopovers.length}}" class="row">
        <text>é€”ç»ç‚¹ï¼š</text>
        <view class="stopovers-display">
          <block wx:for="{{detail.stopovers}}" wx:key="index">
            <text class="stopover-tag">{{item.city}}, {{item.state}}</text>
          </block>
        </view>
      </view>

      <!-- ============ æ‰¾ä¹˜å®¢ï¼ˆrideï¼‰ä¸“å±å­—æ®µ ============ -->
      <block wx:if="{{detail.type==='ride'}}">
        <view class="row">
          <text>ç©ºä½™åº§ä½ï¼š</text><text class="bold">{{detail.empty_seats}}</text>
        </view>

        <!-- ğŸ‘‰ è½¦å‹ï¼šä»…å½“æœ‰å¡«å†™æ—¶æ˜¾ç¤º ğŸ‘ˆ -->
        <view class="row" wx:if="{{detail.car_model}}">
          <text>è½¦å‹ï¼š</text><text class="bold">{{detail.car_model}}</text>
        </view>
      </block>

      <!-- ============ æ‰¾å¸æœºï¼ˆrequestï¼‰ä¸“å±å­—æ®µ ============ -->
      <block wx:elif="{{detail.type==='request'}}">
        <view class="row">
          <text>ä¹˜åäººæ•°ï¼š</text><text class="bold">{{detail.passenger_number}}</text>
        </view>
      </block>

      <!-- å…±ç”¨å­—æ®µï¼šä»·æ ¼ -->
      <view class="row">
        <text>ä»·æ ¼ï¼š$</text><text class="bold">{{detail.price}}</text>
      </view>
      <!-- ç»åœç‚¹ä»·æ ¼æç¤º -->
      <view wx:if="{{detail.stopovers && detail.stopovers.length}}" class="row">
        <text style="font-size:22rpx;color:#999;">åˆ°ç»åœç‚¹ä»·æ ¼éœ€ä¸å¸æœºåå•†</text>
      </view>
    </view>
  </view>

  <!-- ======= å‘å¸ƒè€…ä¿¡æ¯ ======= -->
  <view class="publisher-card">
    <view class="publisher-row">
      <text>å‘å¸ƒè€…ï¼š</text>
      <text class="bold">{{publisherInfo.nickName || 'ç”¨æˆ·'}}</text>
    </view>
    <view class="publisher-row">
      <text>è”ç³»å¾®ä¿¡ï¼š</text>
      <text class="bold">{{publisherInfo.wechat || 'æœªæä¾›'}}</text>
      <button type="primary" size="mini" bindtap="handleCopyWeChat" wx:if="{{publisherInfo.wechat}}">å¤åˆ¶</button>
    </view>
    <!-- ä»…å¯¹è¯·æ±‚å±•ç¤ºå‚ä¸è€…è”ç³»æ–¹å¼åˆ—è¡¨ -->
    <view wx:if="{{detail.type==='request' && participantsInfo && participantsInfo.length}}" style="margin-top:12rpx;">
      <view class="publisher-row"><text class="bold">å‚ä¸è€…å¾®ä¿¡ï¼š</text></view>
      <block wx:for="{{participantsInfo}}" wx:key="openid">
        <view class="publisher-row">
          <text>{{item.nickName || 'ä¹˜å®¢'}}</text>
          <text class="bold" style="margin-left:8rpx;">{{item.wechat || 'æœªæä¾›'}}</text>
          <button wx:if="{{item.wechat}}" type="default" size="mini" data-wxid="{{item.wechat}}" bindtap="copyParticipantWeChat">å¤åˆ¶</button>
        </view>
      </block>
    </view>
  </view>

  <!-- ======= æ“ä½œæŒ‰é’® ======= -->
  <block wx:if="{{userOpenid && userOpenid !== detail.publisher_id}}">
    <button class="action-btn" type="primary" bindtap="takeOrder" wx:if="{{detail.type==='ride'}}">æˆ‘è¦ä¹˜å</button>
    <button class="action-btn" type="primary" bindtap="takeOrder" wx:if="{{detail.type==='request' && canDriverAccept}}">æˆ‘è¦æ¥å•</button>
    <button class="action-btn" type="default"  bindtap="joinAsPassenger" wx:if="{{detail.type==='request' && canJoinAsPassenger}}">åŠ å…¥æ­¤è¯·æ±‚</button>
  </block>
</block>
