<!-- ===================== é¡¶éƒ¨å­ Tab ===================== -->
<view class="tabs">
  <view class="tab {{currentSubTab==='driver'?'active':''}}" data-tab="driver"    bindtap="onSubTabChange">è½¦æ‰¾äºº</view>
  <view class="tab {{currentSubTab==='passenger'?'active':''}}" data-tab="passenger" bindtap="onSubTabChange">äººæ‰¾è½¦</view>
</view>

<!-- ===================== è¡¨å•å¡ç‰‡ ===================== -->
<view class="form-card">
  <!-- å‡ºå‘åŸå¸‚ -->
  <view class="input-row">
    <text class="label">å‡ºå‘åŸå¸‚1</text>
    <input class="input"
           placeholder="è¾“å…¥å‡ºå‘åŸå¸‚"
           value="{{departure_place.city}}"
           bindinput="onDepartureInput" />
  </view>
  <!-- å»ºè®® -->
  <view class="suggestion-list" wx:if="{{departureSuggestions.length}}">
    <block wx:for="{{departureSuggestions}}" wx:key="city">
      <view class="suggest-item" data-item="{{item}}" bindtap="chooseDeparture">
        {{item.city}}, {{item.state}}
      </view>
    </block>
  </view>

  <!-- ç»åœç‚¹ç®¡ç†åŒºåŸŸ -->
  <view class="route-section">
    <view class="route-header">
      <text class="route-title">è¡Œç¨‹è·¯çº¿</text>
      <button class="add-stopover-btn-inline" size="mini" bindtap="addStopover">
        + æ·»åŠ ç»åœç‚¹
      </button>
    </view>
    
    <!-- å®Œæ•´è·¯çº¿æ˜¾ç¤º -->
    <view class="route-display">
      <!-- å‡ºå‘åœ° -->
      <view class="route-point departure">
        <view class="point-icon">ğŸš—</view>
        <view class="point-content">
          <text class="point-label">å‡ºå‘åœ°</text>
          <text class="point-city">{{departure_place.city || 'è¯·é€‰æ‹©å‡ºå‘åŸå¸‚'}}</text>
        </view>
      </view>
      
      <!-- ç»åœç‚¹åˆ—è¡¨ -->
      <block wx:for="{{stopovers}}" wx:key="index">
        <view class="route-connector"></view>
        <view class="route-point stopover">
          <view class="point-icon">ğŸ“</view>
          <view class="point-content">
            <text class="point-label">ç»åœç‚¹ {{index + 1}}</text>
            <text class="point-city">{{item.city}}, {{item.state}}</text>
          </view>
          <button class="remove-point-btn" size="mini" data-index="{{index}}" bindtap="removeStopover">
            Ã—
          </button>
        </view>
      </block>
      
      <!-- ç›®çš„åœ° -->
      <view class="route-connector"></view>
      <view class="route-point destination">
        <view class="point-icon">ğŸ</view>
        <view class="point-content">
          <text class="point-label">ç›®çš„åœ°</text>
          <text class="point-city">{{arrival_place.city || 'è¯·é€‰æ‹©ç›®çš„åŸå¸‚'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å‡ºå‘åœ°å»ºè®® -->
  <view class="suggestion-list" wx:if="{{departureSuggestions.length}}">
    <block wx:for="{{departureSuggestions}}" wx:key="city">
      <view class="suggest-item" data-item="{{item}}" bindtap="chooseDeparture">
        {{item.city}}, {{item.state}}
      </view>
    </block>
  </view>

  <!-- åŸå¸‚é€‰æ‹©è¾“å…¥æ¡†ï¼ˆç›®çš„åœ°ï¼‰ -->
  <view class="input-row">
    <text class="label">ç›®çš„åŸå¸‚</text>
    <input class="input"
           placeholder="è¾“å…¥ç›®çš„åŸå¸‚"
           value="{{arrival_place.city}}"
           bindinput="onArrivalInput" />
  </view>
  <!-- å»ºè®® -->
  <view class="suggestion-list" wx:if="{{arrivalSuggestions.length}}">
    <block wx:for="{{arrivalSuggestions}}" wx:key="city">
      <view class="suggest-item" data-item="{{item}}" bindtap="chooseArrival">
        {{item.city}}, {{item.state}}
      </view>
    </block>
  </view>

  <!-- ç»åœç‚¹è¾“å…¥æ¡† -->
  <view wx:if="{{showStopoverInput}}" class="stopover-input-overlay">
    <view class="stopover-input-modal">
      <view class="modal-header">
        <text>æ·»åŠ ç»åœç‚¹</text>
        <button class="close-btn" bindtap="cancelStopoverInput">Ã—</button>
      </view>
      <input class="stopover-input" 
             placeholder="è¾“å…¥ç»åœåŸå¸‚"
             bindinput="onStopoverInput" 
             auto-focus />
      <view class="suggestion-list" wx:if="{{stopoverSuggestions.length}}">
        <block wx:for="{{stopoverSuggestions}}" wx:key="city">
          <view class="suggest-item" data-item="{{item}}" bindtap="chooseStopover">
            {{item.city}}, {{item.state}}
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- å‡ºå‘æ—¥æœŸ & æ—¶é—´ -->
  <view class="input-row">
    <text class="label">å‡ºå‘æ—¥æœŸ</text>
    <picker class="picker" mode="date"
            start="{{todayString}}"
            value="{{departure_date}}"
            bindchange="onDepartDateChange">
      <view>{{departure_date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
    </picker>
  </view>
  <view class="input-row">
    <text class="label">å‡ºå‘æ—¶é—´</text>
    <picker class="picker" mode="time"
            value="{{departure_time}}"
            bindchange="onDepartTimeChange">
      <view>{{departure_time || '00:00'}}</view>
    </picker>
  </view>

  <!-- ===== åˆ†æ”¯å­—æ®µ ===== -->
  <!-- å¸æœºå‘å¸ƒï¼šè½¦å‹ + ç©ºä½™åº§ä½ -->
  <block wx:if="{{currentSubTab==='driver'}}">
    <view class="input-row">
      <text class="label">è½¦å‹(é€‰å¡«)</text>
      <input class="input"
             placeholder="å¦‚ Toyota Camry"
             value="{{car_model}}"
             data-field="car_model"
             bindinput="onInputChange" />
    </view>
    <view class="input-row">
      <text class="label">ç©ºä½™åº§ä½</text>
      <input class="input"
             type="number"
             placeholder="é»˜è®¤ 3"
             value="{{empty_seats}}"
             data-field="empty_seats"
             bindinput="onInputChange" />
    </view>


  </block>

  <!-- ä¹˜å®¢éœ€æ±‚ï¼šä¹˜åäººæ•° & é€”ç»ç‚¹ -->
  <block wx:elif="{{currentSubTab==='passenger'}}">
    <view class="input-row">
      <text class="label">ä¹˜åäººæ•°</text>
      <input class="input"
             type="number"
             placeholder="é»˜è®¤ 1"
             value="{{passenger_number}}"
             data-field="passenger_number"
             bindinput="onInputChange" />
    </view>
  </block>

  <!-- å…¬å…±å­—æ®µï¼šä»·æ ¼/äºº & å¾®ä¿¡å· -->
  <view class="input-row">
    <text class="label">ä»·æ ¼ $/ äºº</text>
    <input class="input"
           type="number"
           placeholder="å¿…å¡«"
           value="{{price}}"
           data-field="price"
           bindinput="onInputChange" />
  </view>
  <view class="input-row">
    <text class="label">å¾®ä¿¡å·</text>
    <input class="input"
           placeholder="ç”¨äºè”ç³»"
           value="{{contact_wechat}}"
           data-field="contact_wechat"
           bindinput="onInputChange" />
  </view>

  <!-- ä»·æ ¼æç¤º -->
  <view class="input-row" style="margin-top: 0;">
    <text style="font-size:24rpx;color:#888;">åˆ°ç»åœç‚¹çš„ä»·æ ¼éœ€ä¹˜å®¢ä¸å¸æœºåå•†</text>
  </view>

  <!-- æäº¤ -->
  <button class="publish-btn" type="primary" bindtap="submitRide">{{currentSubTab==='driver' ? 'å‘å¸ƒè½¦æ‰¾äºº' : 'å‘å¸ƒäººæ‰¾è½¦'}}</button>
</view>
