<view class="container">
  <view class="tab-bar">
    <button class="{{currentTab === 'passenger' ? 'active' : ''}}" bindtap="switchToPassenger">我乘坐的</button>
    <button class="{{currentTab === 'driver' ? 'active' : ''}}" bindtap="switchToDriver">我接单的</button>
    <button class="{{currentTab === 'mine' ? 'active' : ''}}" bindtap="switchToMine">我发布的</button>
  </view>

  <!-- 我乘坐的 rides -->
  <view wx:if="{{currentTab === 'passenger'}}">
    <block wx:for="{{ridesAsPassenger}}" wx:key="{{item._id}}">
      <view class="ride-item" bindtap="navigateToDetail" data-id="{{item._id}}" data-type="rides">
        <text class="label">出发地：</text><text>{{item.departure_place}}</text>
        <text class="label">目的地：</text><text>{{item.arrival_place}}</text>
        <text class="label">出发时间：</text><text>{{item.departure_date}} {{item.departure_time}}</text>
        <text class="label">价格：</text><text>¥{{item.price}}</text>
        <text class="label">乘坐人数：</text><text>{{item.passengers.length}}</text>
      </view>
    </block>
  </view>

  <!-- 我接单的 rides -->
  <view wx:if="{{currentTab === 'driver'}}">
    <block wx:for="{{ridesAsDriver}}" wx:key="{{item._id}}">
      <view class="ride-item" bindtap="navigateToDetail" data-id="{{item._id}}" data-type="rides">
        <text class="label">出发地：</text><text>{{item.departure_place}}</text>
        <text class="label">目的地：</text><text>{{item.arrival_place}}</text>
        <text class="label">出发时间：</text><text>{{item.departure_date}} {{item.departure_time}}</text>
        <text class="label">价格：</text><text>¥{{item.price}}</text>
        <text class="label">乘坐人数：</text><text>{{item.passengers.length}}</text>
      </view>
    </block>
  </view>

  <!-- 我发布的 (rides + rideRequest) -->
  <view wx:if="{{currentTab === 'mine'}}">
    <text class="section-title">我发布的车找人(rides)：</text>
    <block wx:for="{{myPublishedRides}}" wx:key="{{item._id}}">
      <view class="ride-item" bindtap="navigateToDetail" data-id="{{item._id}}" data-type="rides">
        <text class="label">出发地：</text><text>{{item.departure_place}}</text>
        <text class="label">目的地：</text><text>{{item.arrival_place}}</text>
        <text class="label">出发时间：</text><text>{{item.departure_date}} {{item.departure_time}}</text>
        <view class="input-group">
          <text class="label">价格：</text>
          <input type="number" value="{{item.price}}" data-id="{{item._id}}" bindinput="updatePrice" />
        </view>
        <view class="input-group">
          <text class="label">空余座位：</text>
          <input type="number" value="{{item.empty_seats}}" data-id="{{item._id}}" bindinput="updateSeats" />
        </view>
        <button class="action-btn" bindtap="saveUpdates" data-id="{{item._id}}">保存修改</button>
        <button class="action-btn delete-btn" bindtap="deletePublishedRide" data-id="{{item._id}}">删除</button>
      </view>
    </block>

    <text class="section-title">我发布的人找车(rideRequest)：</text>
    <block wx:for="{{myPublishedRequests}}" wx:key="{{item._id}}">
      <view class="request-item" bindtap="navigateToDetail" data-id="{{item._id}}" data-type="request">
        <view><text class="label">出发地：</text><text>{{item.departure_place}}</text></view>
        <view><text class="label">目的地：</text><text>{{item.arrival_place}}</text></view>
        <view><text class="label">出发时间：</text><text>{{item.departure_date}} {{item.departure_time || '未知'}}</text></view>
        <view class="input-group">
          <text class="label">期望价格：</text>
          <input type="number" value="{{item.price}}" data-id="{{item._id}}" bindinput="updateRequestPrice" />
        </view>
        <view class="input-group">
          <text class="label">乘坐人数：</text>
          <input type="number" value="{{item.passenger_number}}" data-id="{{item._id}}" bindinput="updatePassengerNumber" />
        </view>
        <button class="action-btn" bindtap="saveRequestUpdates" data-id="{{item._id}}">保存修改</button>
        <button class="action-btn delete-btn" bindtap="deletePublishedRequest" data-id="{{item._id}}">删除</button>
      </view>
    </block>
  </view>
</view>
