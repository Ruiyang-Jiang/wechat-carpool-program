<!-- 顶部 Tab -->
<view class="tabs">
  <view class="tab {{currentView==='passenger'?'active':''}}" bindtap="gotoFindPassenger">找乘客</view>
  <view class="tab {{currentView==='driver'?'active':''}}"    bindtap="gotoFindDriver">找司机</view>
</view>

<!-- ========================== 找乘客 ========================== -->
<block wx:if="{{currentView==='passenger'}}">

  <!-- ===== 搜索提示 ===== -->
  <view wx:if="{{showPassengerSearchPrompt}}" class="search-tip">
    请返回首页设置搜索条件
  </view>

  <!-- ===== 数据与排序 ===== -->
  <block wx:else>

    <!-- ---------- 排序控件 ---------- -->
    <view class="sort-bar">
      <!-- 排序字段 -->
      <picker mode="selector"
              range="{{passengerSortFields}}"
              range-key="label"
              value="{{passengerSortFieldIndex}}"
              bindchange="onPassengerSortFieldChange">
        <view class="picker">
          排序字段：{{passengerSortFields[passengerSortFieldIndex].label}}
        </view>
      </picker>

      <!-- 升/降序 -->
      <picker mode="selector"
              range="{{passengerSortOrderOptions}}"
              range-key="label"
              value="{{passengerSortOrderIndex}}"
              bindchange="onPassengerSortOrderChange">
        <view class="picker">
          {{passengerSortOrderOptions[passengerSortOrderIndex].label}}
        </view>
      </picker>
    </view>

    <!-- ---------- 卡片列表 ---------- -->
    <block wx:for="{{passengerData}}" wx:key="_id">
      <view class="ride-card {{item.isPast?'past':''}}" data-id="{{item._id}}" data-type="{{item.type}}"
            bindtap="chooseItem">
        <!-- header -->
        <view class="ride-header">
          <text class="badge badge-driver">{{item.displayType}}</text>
          <text class="ride-date {{item.isPast?'date-past':''}}">
            {{item.departure_date}} {{item.departure_time||'00:00'}}
          </text>
          <text wx:if="{{item.isPast}}" class="expired-badge">已过期</text>
        </view>

        <!-- body -->
        <view class="ride-body">
          <view class="row">
            <text>出发地：</text><text class="bold">{{item.departure_place.city}}, {{item.departure_place.state}}</text>
          </view>
          <view class="row">
            <text>目的地：</text><text class="bold">{{item.arrival_place.city}}, {{item.arrival_place.state}}</text>
          </view>
          <view class="row">
            <text>空余座位：</text><text class="bold">{{item.empty_seats}}</text>
          </view>
          <view class="row">
            <text>价格：</text><text class="bold">{{item.price}}</text>
          </view>
        </view>
      </view>
    </block>
  </block>
</block>

<!-- ========================== 找司机 ========================== -->
<block wx:elif="{{currentView==='driver'}}">

  <!-- ===== 搜索提示 ===== -->
  <view wx:if="{{showDriverSearchPrompt}}" class="search-tip">
    请返回首页设置搜索条件
  </view>

  <!-- ===== 数据与排序 ===== -->
  <block wx:else>

    <!-- ---------- 排序控件 ---------- -->
    <view class="sort-bar">
      <picker mode="selector"
              range="{{driverSortFields}}"
              range-key="label"
              value="{{driverSortFieldIndex}}"
              bindchange="onDriverSortFieldChange">
        <view class="picker">
          排序字段：{{driverSortFields[driverSortFieldIndex].label}}
        </view>
      </picker>

      <picker mode="selector"
              range="{{driverSortOrderOptions}}"
              range-key="label"
              value="{{driverSortOrderIndex}}"
              bindchange="onDriverSortOrderChange">
        <view class="picker">
          {{driverSortOrderOptions[driverSortOrderIndex].label}}
        </view>
      </picker>
    </view>

    <!-- ---------- 卡片列表 ---------- -->
    <block wx:for="{{driverData}}" wx:key="_id">
      <view class="ride-card {{item.isPast?'past':''}}" data-id="{{item._id}}" data-type="{{item.type}}"
            bindtap="chooseItem">
        <view class="ride-header">
          <text class="badge badge-passenger">{{item.displayType}}</text>
          <text class="ride-date {{item.isPast?'date-past':''}}">
            {{item.departure_date}} {{item.departure_time||'00:00'}}
          </text>
          <text wx:if="{{item.isPast}}" class="expired-badge">已过期</text>
        </view>

        <view class="ride-body">
          <view class="row">
            <text>出发地：</text><text class="bold">{{item.departure_place.city}}, {{item.departure_place.state}}</text>
          </view>
          <view class="row">
            <text>目的地：</text><text class="bold">{{item.arrival_place.city}}, {{item.arrival_place.state}}</text>
          </view>
          <view class="row">
            <text>乘坐人数：</text><text class="bold">{{item.passenger_number}}</text>
          </view>
          <view class="row">
            <text>期望价格：</text><text class="bold">{{item.price}}</text>
          </view>
        </view>
      </view>
    </block>
  </block>
</block>
